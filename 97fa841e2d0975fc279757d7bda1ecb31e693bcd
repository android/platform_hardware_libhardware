{
  "comments": [
    {
      "key": {
        "uuid": "RjvRx2PU",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000413
      },
      "writtenOn": "2013-03-12T20:05:19Z",
      "side": 1,
      "message": "This is a good start. Colin and I were just discussing this (regarding exists()) and I realized that this is not done correctly. The vibrator on/off functions should not be methods on the module. The module should just retain an open. You don\u0027t even need your own module definition. What you do need is a device definition for your vibrator device which will be returned by the open call on the module. What you can do then is fail open() (with ENODEV) if the device doesn\u0027t exist. This way the vibrator.default.so will work the same way the current code does and you don\u0027t need a weird \"exists()\" call.\n\nMakes sense?",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "Rr1Nj5L8",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-14T13:05:34Z",
      "side": 1,
      "message": "OK, so if we got it right, we will create a new \"vibra_device_t\" struct deriving hw_device_t, looking like:\n\nstruct hw_device_t {\n  hw_device_t common;\n  int (*vibrator_on)(int timeout_ms);\n  int (*vibrator_on)(void);\n}\n\nthe sequence will look like (approximately; I\u0027m not respecting the API here, for simplicity):\n\nmodule \u003d hw_get_module(); // May fail is no vibrator module is compiled\n  where hw_get_module is:\n  device \u003d module.open();\n    where module.open is:\n    return isDevicePresent() ? device : ENODEV;\n\nand later:\n\nmodule.vibrator_on();\n  where module.vibrator_on is:\n  device.vibrator_on()\n\n\nright ?\nWe will submit a new patchset within a week.",
      "parentUuid": "RjvRx2PU",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZOQWLmM",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 48,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-12T01:06:15Z",
      "side": 1,
      "message": "int (*vibrator_exists)(void);",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RgeSUlDk",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 48,
      "author": {
        "id": 1000413
      },
      "writtenOn": "2013-03-12T08:21:09Z",
      "side": 1,
      "message": "This shouldn\u0027t be here. Please remove. If the device doesn\u0027t have a vibrator, then there shouldn\u0027t be a HAL installed. If the consumer of this HAL can deal with the device missing then it should be able to deal with the HAL missing in the exact same way.",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RgURnwJk",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 48,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-12T09:21:07Z",
      "side": 1,
      "message": "True. It means that in com_android_server_VibratorService.cpp (https://android-review.googlesource.com/#/c/49230/2/services/jni/com_android_server_VibratorService.cpp), the \u0027vibratorExists\u0027 function should be defined like:\n\nstatic jboolean vibratorExists(JNIEnv *env, jobject clazz)\n{\n    return gVibraModule ? JNI_TRUE : JNI_FALSE;\n}\n\nis that ok for you ?",
      "parentUuid": "RgeSUlDk",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScFLLNG8",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 48,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RgeSUlDk",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZIf9bPc",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-12T01:06:15Z",
      "side": 1,
      "message": "\"negative if error\", so we can exit codes.",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScNILpNk",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RZIf9bPc",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZOcLkC4",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-12T01:06:15Z",
      "side": 1,
      "message": "\"negative if error\"",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScLIOIOs",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RZOcLkC4",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZMQZMpQ",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-12T01:06:15Z",
      "side": 1,
      "message": "int (*vibrator_off)(void);",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScJIRHAw",
        "filename": "include/hardware/vibrator.h",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RZMQZMpQ",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZD4EqV0",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 31,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-11T18:11:27Z",
      "side": 1,
      "message": "Is there any other changes to the original vibrator.c code other than changing everything to C++-esque camelCase naming?",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScPLbSDY",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 31,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "we have reverted the camelCase style.  The most significant change is the creation of a vibra_device type deriving hw_device_t",
      "parentUuid": "RZD4EqV0",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZOckcL8",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2013-03-11T22:43:14Z",
      "side": 1,
      "message": "The qemu stuff could go in a separate HAL",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RgSRkvJI",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-12T09:21:07Z",
      "side": 1,
      "message": "Do you mean a \"vibrator.qemu.so\" module ?",
      "parentUuid": "RZOckcL8",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RjtTRPKk",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1000413
      },
      "writtenOn": "2013-03-12T20:05:19Z",
      "side": 1,
      "message": "It\u0027d be vibrator.goldfish.so",
      "parentUuid": "RgSRkvJI",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZP7wgVs",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-11T18:11:27Z",
      "side": 1,
      "message": "This can just be #defined and explained there; we don\u0027t need the arithmetic for this calculation here.",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RgQSeWEg",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-12T09:21:07Z",
      "side": 1,
      "message": "ok. There is a \"+1\" missing, as well, for the \u0027\\n\u0027 line 69; we\u0027ll add it.",
      "parentUuid": "RZP7wgVs",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScFKiVKc",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RgQSeWEg",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZJ4SHaA",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 77,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-11T18:11:27Z",
      "side": 1,
      "message": "static",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScHKnWLY",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 77,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RZJ4SHaA",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZH7.MSs",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-11T18:11:27Z",
      "side": 1,
      "message": "static",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScJK73M4",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RZH7.MSs",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RgaSejFM",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 99,
      "author": {
        "id": 1000413
      },
      "writtenOn": "2013-03-12T08:21:09Z",
      "side": 1,
      "message": "use module_api_version and hal_api_version, see hardware.h",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ScLK44NI",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 99,
      "author": {
        "id": 1012411
      },
      "writtenOn": "2013-03-28T17:02:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "RgaSejFM",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "RZF75dUA",
        "filename": "modules/vibrator/vibrator.c",
        "patchSetId": 1
      },
      "lineNbr": 105,
      "author": {
        "id": 1012391
      },
      "writtenOn": "2013-03-11T18:11:27Z",
      "side": 1,
      "message": "indentation",
      "revId": "97fa841e2d0975fc279757d7bda1ecb31e693bcd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}